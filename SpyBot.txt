import asyncio
from flask import Flask
import logging
from aiogram import Bot, Dispatcher, types, F
from threading import Thread

TOKEN = "7841230741:AAHuTIB5P1cjcEOBTarUIYnyXgd9yYgdDk8"
GROUP_ID = -1001888670791  # ID –≥—Ä—É–ø–ø—ã (–æ—Ç–∫—É–¥–∞ –ø–µ—Ä–µ—Å—ã–ª–∞—Ç—å)
CHANNEL_ID = -1002339645578  # ID –∫–∞–Ω–∞–ª–∞ (–∫—É–¥–∞ –ø–µ—Ä–µ—Å—ã–ª–∞—Ç—å)

bot = Bot(token=TOKEN)
dp = Dispatcher()

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–µ—Ä–µ—Å—ã–ª–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
@dp.message(F.chat.id == GROUP_ID)
async def forward_messages(message: types.Message):
    user_id = message.from_user.id if message.from_user else "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π"
    msg_link = f"https://t.me/c/{str(GROUP_ID)[4:]}/{message.message_id}"

    caption = f"üë§ ID –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è: `{user_id}`\nüîó [–û—Ä–∏–≥–∏–Ω–∞–ª —Å–æ–æ–±—â–µ–Ω–∏—è]({msg_link})"

    # –ü–µ—Ä–µ—Å—ã–ª–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –∫–∞–Ω–∞–ª
    await bot.forward_message(CHANNEL_ID, GROUP_ID, message.message_id)
    await bot.send_message(CHANNEL_ID, caption, parse_mode="Markdown")


# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Flask
app = Flask(__name__)

@app.route('/')
def hello_world():
    return 'Hello, World!'

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ Flask –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ
def run_flask():
    app.run(host='0.0.0.0', port=5000)

# –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞
async def start_bot():
    logging.basicConfig(level=logging.INFO)
    print("–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω!")
    await dp.start_polling(bot)

if __name__ == '__main__':
    # –ó–∞–ø—É—Å–∫–∞–µ–º Flask –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ
    flask_thread = Thread(target=run_flask)
    flask_thread.start()

    # –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞
    asyncio.run(start_bot())
